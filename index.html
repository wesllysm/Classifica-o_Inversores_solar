<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Completo - Dimensionamento Inversores</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .config-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border-left: 5px solid #3498db;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #495057;
            min-width: 200px;
        }

        .result-value {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1em;
            text-align: right;
            flex: 1;
        }

        .highlight {
            color: #e74c3c;
            background: #fff5f5;
            padding: 3px 8px;
            border-radius: 5px;
        }

        .concessionaria-info {
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid;
        }

        .celpe { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; border-left-color: #c23616; }
        .energisa { background: linear-gradient(135deg, #00b894 0%, #00a085 100%); color: white; border-left-color: #008f7a; }
        .neoenergia { background: linear-gradient(135deg, #0984e3 0%, #074b83 100%); color: white; border-left-color: #063970; }
        .equatorial { background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white; border-left-color: #8e44ad; }
        .cemig { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; border-left-color: #d35400; }

        .concessionaria-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .concessionaria-item:last-child {
            border-bottom: none;
        }

        .concessionaria-label {
            font-weight: 600;
        }

        .concessionaria-value {
            font-weight: 700;
            font-size: 1.1em;
        }

        .demanda-info {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .demanda-info h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #6c757d;
            border-top: 1px solid #e9ecef;
        }

        .inversor-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .inversor-selection select {
            flex: 1;
        }

        .inversor-selection button {
            padding: 12px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .inversor-selection button:hover {
            background: #2980b9;
        }

        .selected-inversors {
            margin-top: 15px;
        }

        .selected-inversor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .selected-inversor button {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .selected-inversor button:hover {
            background: #c0392b;
        }

        .inversor-details {
            margin-top: 20px;
            padding: 15px;
            background: #f1f8ff;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .inversor-details h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .inversor-detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .inversor-detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
        }

        .detail-value {
            font-weight: 700;
            color: #2c3e50;
        }

        .protecao-individual {
            background: #fff3e0;
            border: 1px solid #ffb74d;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .config-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><img src="Imagens/√çCONE Joule.png" alt="joule" style="width:45px;height:45px;"> Sistema Completo - Dimensionamento</h1>
            <p>Dimensionamento de inversores fotovoltaicos para diferentes concession√°rias</p>
        </div>

        <div class="content">
            <div class="config-group">
                <div class="form-group">
                    <label for="concessionariaSelect">üè¢ Concession√°ria:</label>
                    <select id="concessionariaSelect">
                        <option value="">-- Selecione --</option>
                        <option value="CELPE">CELPE/COSERN</option>
                        <option value="ENERGISA_PB">ENERGISA PB</option>
                        <option value="NEOENERGIA">Neoenergia (PE/COSEM/DF)</option>
                        <option value="EQUATORIAL">Equatorial AL/PI</option>
                        <option value="CEMIG">CEMIG</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="inversorSelect">üìã Inversor:</label>
                    <div class="inversor-selection">
                        <select id="inversorSelect">
                            <option value="">-- Selecione --</option>
                        </select>
                        <button id="addInversorBtn">Adicionar</button>
                    </div>
                    <div class="selected-inversors" id="selectedInversors">
                        <!-- Inversores selecionados aparecer√£o aqui -->
                    </div>
                </div>
            </div>

            <div class="form-group" id="configTensaoGroup" style="display: none;">
                <label for="configTensao">‚ö° Configura√ß√£o de Entrada:</label>
                <select id="configTensao">
                    <option value="MONOFASICO">Monof√°sico</option>
                    <option value="TRIFASICO">Trif√°sico</option>
                </select>
                <div class="warning" id="warningTrifasico" style="display: none;">
                    ‚ö†Ô∏è Inversor trif√°sico s√≥ pode ser conectado em rede trif√°sica
                </div>
            </div>

            <!-- Configura√ß√£o espec√≠fica para Equatorial -->
            <div class="form-group" id="configOrlaGroup" style="display: none;">
                <label for="configOrla">üèñÔ∏è Dist√¢ncia da Orla Mar√≠tima (Equatorial):</label>
                <select id="configOrla">
                    <option value="ATE_2KM">At√© 2 km da orla</option>
                    <option value="ACIMA_2KM">Acima de 2 km da orla</option>
                </select>
            </div>

            <!-- Informa√ß√£o sobre carga necess√°ria -->
            <div class="info" id="cargaNecessariaInfo" style="display: none;">
                <strong>üí° Informa√ß√£o sobre Carga Instalada:</strong> 
                <span id="cargaNecessariaText"></span>
            </div>

            <!-- Mensagem de ajuste autom√°tico -->
            <div class="success" id="autoAdjustMessage" style="display: none;">
                <strong>‚úÖ Sistema ajustado automaticamente!</strong> 
                <span id="adjustmentDetails"></span>
            </div>

            <div class="results" id="results" style="display: none;">
                <div class="result-item">
                    <span class="result-label">üî¢ Quantidade de Inversores:</span>
                    <span class="result-value" id="quantidade">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">‚ö° Corrente M√°xima Total:</span>
                    <span class="result-value" id="corrente">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">üîã Pot√™ncia Total dos Inversores:</span>
                    <span class="result-value" id="potenciaTotal">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">üîß Disjuntor Principal:</span>
                    <span class="result-value highlight" id="disjuntor">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">üîå Cabos do Ramal:</span>
                    <span class="result-value highlight" id="cabos">-</span>
                </div>
            </div>

            <div class="demanda-info" id="demandaInfo" style="display: none;">
                <h4>üìä Requisitos de Carga/Demanda</h4>
                <div class="result-item">
                    <span class="result-label">Faixa de Demanda da Classe:</span>
                    <span class="result-value" id="faixaDemanda">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Classe do Sistema:</span>
                    <span class="result-value" id="classeSistema">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Pot√™ncia Disponibilizada (PD):</span>
                    <span class="result-value" id="potenciaDisponibilizada">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Status da Pot√™ncia:</span>
                    <span class="result-value" id="statusPotencia">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Carga M√≠nima Necess√°ria:</span>
                    <span class="result-value highlight" id="cargaMinima">-</span>
                </div>
            </div>

            <div class="concessionaria-info" id="concessionariaInfo" style="display: none;">
                <h3>üè† PADR√ÉO DE ENTRADA - <span id="infoConcessionariaNome">-</span></h3>
                <div class="concessionaria-item">
                    <span class="concessionaria-label">Disjuntor Principal:</span>
                    <span class="concessionaria-value" id="infoDisjuntor">-</span>
                </div>
                <div class="concessionaria-item">
                    <span class="concessionaria-label">Cabo Fase/Neutro:</span>
                    <span class="concessionaria-value" id="infoCabo">-</span>
                </div>
                <div class="concessionaria-item">
                    <span class="concessionaria-label">Ramal de Entrada:</span>
                    <span class="concessionaria-value" id="infoRamal">-</span>
                </div>
                <div class="concessionaria-item">
                    <span class="concessionaria-label">Configura√ß√£o:</span>
                    <span class="concessionaria-value" id="infoTipo">-</span>
                </div>
            </div>

            <!-- Se√ß√£o de prote√ß√£o individual dos inversores -->
            <div id="protecaoInversores" style="display: none;">
                <div class="inversor-details">
                    <h4>üîß Sistema de Prote√ß√£o Individual para Cada Inversor</h4>
                    <div id="detalhesProtecaoInversores">
                        <!-- Detalhes de prote√ß√£o aparecer√£o aqui -->
                    </div>
                </div>
            </div>

            <div id="inversoresDetails"></div>
            
        </div>

        <div class="footer">
            <p>Sistema de Dimensionamento - Baseado nas normas das concession√°rias</p><br>
            <p>JouleLab Energia Solar‚ö°</p>
        </div>
    </div>

    <script>
        // Banco de dados completo de inversores COM POT√äNCIA (CORRIGIDO)
        const bancoDeDados = [
            // Monof√°sicos
            { inversor: "AUXSOL - ASN-3SL", corrente: 15, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "AUXSOL - ASN-4SL-G2", corrente: 20, classe: "MONOF√ÅSICO", potencia: 4 },
            { inversor: "AUXSOL - ASN-5SL-G2", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "AUXSOL - ASN-6SL-G2", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "AUSTA - AU6K1P", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "AUSTA - AU5K1P", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "AUSTA - AU8K1P", corrente: 36.4, classe: "MONOF√ÅSICO", potencia: 8 },
            { inversor: "AUSTA - AU10K1P", corrente: 45.5, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "BELENERGY - BEL-3K-G", corrente: 15, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "BELENERGY - BEL-5K-G", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "DEYE - SUN-3K-G", corrente: 14, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "DEYE - SUN-5K-G", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "DEYE - SUN-8K-G", corrente: 40, classe: "MONOF√ÅSICO", potencia: 8 },
            { inversor: "DEYE - SUN-10K-G", corrente: 50, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "GOODWE - GW5K-DNS-G40", corrente: 22.8, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "GOODWE - GW6K-DNS-G40", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "GOODWE - GW7.5K-MS-G40", corrente: 34.1, classe: "MONOF√ÅSICO", potencia: 7.5 },
            { inversor: "GOODWE - GW10K-MS-G40", corrente: 45.5, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "GROWATT - MIN3000TL-X", corrente: 13.6, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "GROWATT - MIN5000TL-X", corrente: 22.7, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "GROWATT - MIN6000TL-X", corrente: 27.2, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "HUAWEI - SUN2000-3KTL-L1", corrente: 15, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "HUAWEI - SUN2000-4KTL-L1", corrente: 20, classe: "MONOF√ÅSICO", potencia: 4 },
            { inversor: "HUAWEI - SUN2000-5KTL-L1", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "HUAWEI - SUN2000-6KTL-L1", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "HUAWEI - SUN2000-7.5K-LC0", corrente: 34.09, classe: "MONOF√ÅSICO", potencia: 7.5 },
            { inversor: "HUAWEI - SUN2000-8K-LC0", corrente: 40, classe: "MONOF√ÅSICO", potencia: 8 },
            { inversor: "HUAWEI - SUN2000-10K-LC0", corrente: 45.5, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "HOPEWIND - HSSP3K-G01", corrente: 15, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "HOPEWIND - HSSP4K-G01", corrente: 20, classe: "MONOF√ÅSICO", potencia: 4 },
            { inversor: "HOPEWIND - HSSP5K-G01", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "HOPEWIND - HSSP6K-G01", corrente: 30, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "HOPEWIND - HSSP8K-G01", corrente: 40, classe: "MONOF√ÅSICO", potencia: 8 },
            { inversor: "HOPEWIND - HSSP10K-G01", corrente: 50, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "LIVOLTEK - GT1-3K-SS", corrente: 15, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "LIVOLTEK - GT1-5K-DS", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "LIVOLTEK - GT1-6K-DS", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "NANSEN - ASN-4SL-G2", corrente: 20, classe: "MONOF√ÅSICO", potencia: 4 },
            { inversor: "NANSEN - ASN-5SL-G2", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "NANSEN - ASN-6SL-G2", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "NANSEN - ASN-9SL", corrente: 40.9, classe: "MONOF√ÅSICO", potencia: 9 },
            { inversor: "NANSEN - ASN-10SL", corrente: 45.5, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "SOFAR SOLAR - SOFAR 5KTLM-G3", corrente: 25, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "SOFAR SOLAR - SOFAR 6KTLM-G3", corrente: 29, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "SOFAR SOLAR - SOFAR 7.5KTLM-G3-BR", corrente: 36.2, classe: "MONOF√ÅSICO", potencia: 7.5 },
            { inversor: "SOFAR SOLAR - SOFAR 10KTLM-G3", corrente: 46, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "SAJ - R5-3K-S2-15", corrente: 14.4, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "SAJ - R5-4K-S2-15", corrente: 19.2, classe: "MONOF√ÅSICO", potencia: 4 },
            { inversor: "SAJ - R5-5K-S2-15", corrente: 23.9, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "SAJ - R5-6K-S2-15", corrente: 26.1, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "SAJ - R5-7.5K-S2-15", corrente: 32.6, classe: "MONOF√ÅSICO", potencia: 7.5 },
            { inversor: "SAJ - R5-8K-S2-15", corrente: 34.8, classe: "MONOF√ÅSICO", potencia: 8 },
            { inversor: "SUNGROW - SG3.0-RS", corrente: 13.7, classe: "MONOF√ÅSICO", potencia: 3 },
            { inversor: "SUNGROW - SG4.0-RS", corrente: 18.2, classe: "MONOF√ÅSICO", potencia: 4 },
            { inversor: "SUNGROW - SG5.0-RS", corrente: 22.8, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "SUNGROW - SG6.0-RS", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "SUNGROW - SG8.0-RS", corrente: 36.4, classe: "MONOF√ÅSICO", potencia: 8 },
            { inversor: "SUNGROW - SG10.0-RS", corrente: 45.5, classe: "MONOF√ÅSICO", potencia: 10 },
            { inversor: "SOLIS - S6-GR1P5K-S", corrente: 22.7, classe: "MONOF√ÅSICO", potencia: 5 },
            { inversor: "SOLIS - S6-GR1P6K-S", corrente: 27.3, classe: "MONOF√ÅSICO", potencia: 6 },
            { inversor: "SOLIS - Solis-1P-7K-5G", corrente: 35, classe: "MONOF√ÅSICO", potencia: 7 },
            { inversor: "SOLIS - Solis-1P-7.7K-5G", corrente: 35, classe: "MONOF√ÅSICO", potencia: 7.7 },
            { inversor: "HYPONTECH - HMS-2000W (MICRO) ", corrente: 9.15, classe: "MONOF√ÅSICO", potencia: 2 },
            
            // Trif√°sicos
            { inversor: "DEYE - SUN-12K-G04", corrente: 19.1, classe: "TRIF√ÅSICO", potencia: 12 },
            { inversor: "DEYE - SUN-15K-G04", corrente: 22.5, classe: "TRIF√ÅSICO", potencia: 15 },
            { inversor: "DEYE - SUN-20K-G04", corrente: 30.2, classe: "TRIF√ÅSICO", potencia: 20 },
            { inversor: "DEYE - SUN-75K-G", corrente: 115, classe: "TRIF√ÅSICO", potencia: 75 },
            { inversor: "GOODWE - GW12K-SDT-30", corrente: 18.2, classe: "TRIF√ÅSICO", potencia: 12 },
            { inversor: "GOODWE - GW15K-SDT-20", corrente: 24, classe: "TRIF√ÅSICO", potencia: 15 },
            { inversor: "GOODWE - GW17K-SDT-20", corrente: 27.1, classe: "TRIF√ÅSICO", potencia: 17 },
            { inversor: "GOODWE - GW20K-SDT-20", corrente: 32, classe: "TRIF√ÅSICO", potencia: 20 },
            { inversor: "HUAWEI - SUN2000-12K-MB0", corrente: 20.2, classe: "TRIF√ÅSICO", potencia: 12 },
            { inversor: "HUAWEI - SUN2000-15K-MB0", corrente: 25.2, classe: "TRIF√ÅSICO", potencia: 15 },
            { inversor: "HUAWEI - SUN2000-20K-MB0", corrente: 33.6, classe: "TRIF√ÅSICO", potencia: 20 },
            { inversor: "HUAWEI - SUN2000-50KTL-M3", corrente: 84, classe: "TRIF√ÅSICO", potencia: 50 },
            { inversor: "HOPEWIND - HOPESUN 12KTL", corrente: 19.1, classe: "TRIF√ÅSICO", potencia: 12 },
            { inversor: "HOPEWIND - HOPESUN 15KTL", corrente: 23.9, classe: "TRIF√ÅSICO", potencia: 15 },
            { inversor: "HOPEWIND - HOPESUN 17KTL", corrente: 27, classe: "TRIF√ÅSICO", potencia: 17 },
            { inversor: "HOPEWIND - HOPESUN 30KTL", corrente: 47.8, classe: "TRIF√ÅSICO", potencia: 30 },
            { inversor: "SAJ - R6-20K-T3-32-LV", corrente: 57.7, classe: "TRIF√ÅSICO", potencia: 20 },
            { inversor: "SOLIS - SOLIS-25K-5G", corrente: 41.8, classe: "TRIF√ÅSICO", potencia: 25 },
            { inversor: "SOLIS - Solis-30K-5G", corrente: 50.2, classe: "TRIF√ÅSICO", potencia: 30 },
            { inversor: "SOLIS - Solis-60K-4G", corrente: 100, classe: "TRIF√ÅSICO", potencia: 60 }
        ];

        // Estrutura CORRIGIDA das classes de demanda com PD
        const classesDemanda = {
            "CELPE": {
                "MONOFASICO": [
                    {min: 0, max: 10, classe: "M2", pd: 8.096},
                    {min: 10.1, max: 15, classe: "M3", pd: 12.75}
                ],
                "TRIFASICO": [
                    {min: 0, max: 21, classe: "T6", pd: 21.0},
                    {min: 21.1, max: 26, classe: "T7", pd: 26.0},
                    {min: 26.1, max: 33, classe: "T8", pd: 33.0},
                    {min: 33.1, max: 40, classe: "T9", pd: 40.0},
                    {min: 40.1, max: 52, classe: "T10", pd: 52.0},
                    {min: 52.1, max: 66, classe: "T11", pd: 66.0},
                    {min: 66.1, max: 75, classe: "T12", pd: 75.0}
                ]
            },
            "ENERGISA_PB": {
                "MONOFASICO": [
                    {min: 0, max: 6, classe: "M1", pd: 6.47},
                    {min: 6.1, max: 11, classe: "M2", pd: 8.2},
                    {min: 11.1, max: 15.4, classe: "M3", pd: 13.8}
                ],
                "TRIFASICO": [
                    {min: 0, max: 26.1, classe: "T1", pd: 26.1},
                    {min: 26.2, max: 32.6, classe: "T2", pd: 32.6},
                    {min: 32.7, max: 46.1, classe: "T3", pd: 46.1},
                    {min: 46.2, max: 65.8, classe: "T4", pd: 65.8},
                    {min: 65.9, max: 81.5, classe: "T5", pd: 81.5}
                ]
            },
            "EQUATORIAL": {
                "MONOFASICO": [
                    {min: 0, max: 4, classe: "M1", pd: 5.75},
                    {min: 4.1, max: 8, classe: "M2", pd: 8.2},
                    {min: 8.1, max: 12, classe: "M3", pd: 13.8}
                ],
                "TRIFASICO": [
                    {min: 0, max: 20, classe: "T1", pd: 20.0},
                    {min: 20.1, max: 30, classe: "T2", pd: 30.0},
                    {min: 30.1, max: 40, classe: "T3", pd: 40.0},
                    {min: 40.1, max: 50, classe: "T4", pd: 50.0},
                    {min: 50.1, max: 75, classe: "T5", pd: 75.0}
                ]
            },
            "NEOENERGIA": {
                "MONOFASICO": [
                    {min: 0, max: 10, classe: "M2/M3", pd: 8.2},
                    {min: 10.1, max: 15, classe: "M3", pd: 13.8}
                ],
                "TRIFASICO": [
                    {min: 0, max: 21, classe: "T6", pd: 21.0},
                    {min: 21.1, max: 26, classe: "T7", pd: 26.0}
                ]
            },
            "CEMIG": {
                "MONOFASICO": [
                    {min: 0, max: 10, classe: "M2/M3", pd: 8.2},
                    {min: 10.1, max: 15, classe: "M3", pd: 13.8}
                ],
                "TRIFASICO": [
                    {min: 0, max: 21, classe: "T6", pd: 21.0},
                    {min: 21.1, max: 26, classe: "T7", pd: 26.0}
                ]
            }
        };

        // Estrutura de dimensionamento CORRIGIDA com configura√ß√£o para Equatorial
        const dimensionamento = {
            "CELPE": {
                "M2": {
                    "MONOFASICO": {
                        disjuntor: "40A MONOPOLAR CURVA C",
                        cabo: "6mm¬≤ - 1KV - XLPE",
                        ramal: "Ramal monof√°sico padr√£o",
                        tipo: "CATEGORIA M2"
                    }
                },
                "M3": {
                    "MONOFASICO": {
                        disjuntor: "63A MONOPOLAR CURVA C",
                        cabo: "16mm¬≤ - 1KV - XLPE",
                        ramal: "Ramal monof√°sico refor√ßado",
                        tipo: "CATEGORIA M3"
                    }
                },
                "T6": {
                    "TRIFASICO": {
                        disjuntor: "32A TRIPOLAR CURVA C",
                        cabo: "6mm¬≤ - 1KV - XLPE",
                        ramal: "3x6+6 CU XLPE",
                        tipo: "CATEGORIA T6"
                    }
                },
                "T7": {
                    "TRIFASICO": {
                        disjuntor: "40A TRIPOLAR CURVA C",
                        cabo: "10mm¬≤ - 1KV - XLPE",
                        ramal: "3x10+10 CU XLPE",
                        tipo: "CATEGORIA T7"
                    }
                },
                "T8": {
                    "TRIFASICO": {
                        disjuntor: "50A TRIPOLAR CURVA C",
                        cabo: "16mm¬≤ - 1KV - XLPE",
                        ramal: "3x16+16 CU XLPE",
                        tipo: "CATEGORIA T8"
                    }
                },
                "T9": {
                    "TRIFASICO": {
                        disjuntor: "63A TRIPOLAR CURVA C",
                        cabo: "16mm¬≤ - 1KV - XLPE",
                        ramal: "3x16+16 CU XLPE",
                        tipo: "CATEGORIA T9"
                    }
                },
                "T10": {
                    "TRIFASICO": {
                        disjuntor: "80A TRIPOLAR CURVA C",
                        cabo: "25mm¬≤ - 1KV - XLPE",
                        ramal: "3x25+25 CU XLPE",
                        tipo: "CATEGORIA T10"
                    }
                },
                "T11": {
                    "TRIFASICO": {
                        disjuntor: "100A TRIPOLAR CURVA C",
                        cabo: "35mm¬≤ - 1KV - XLPE",
                        ramal: "3x35+35 CU XLPE",
                        tipo: "CATEGORIA T11"
                    }
                },
                "T12": {
                    "TRIFASICO": {
                        disjuntor: "125A TRIPOLAR CURVA C",
                        cabo: "50mm¬≤ - 1KV - XLPE",
                        ramal: "3x50+50 CU XLPE",
                        tipo: "CATEGORIA T12"
                    }
                }
            },
            "ENERGISA_PB": {
                "M1": {
                    "MONOFASICO": {
                        disjuntor: "32A MONOPOLAR CURVA C",
                        cabo: "6mm¬≤ - 1KV - XLPE",
                        ramal: "Ramal monof√°sico padr√£o",
                        tipo: "CATEGORIA M1"
                    }
                },
                "M2": {
                    "MONOFASICO": {
                        disjuntor: "50A MONOPOLAR CURVA C",
                        cabo: "6mm¬≤ - 1KV - XLPE",
                        ramal: "Ramal monof√°sico intermedi√°rio",
                        tipo: "CATEGORIA M2"
                    }
                },
                "M3": {
                    "MONOFASICO": {
                        disjuntor: "70A MONOPOLAR CURVA C",
                        cabo: "10mm¬≤ - 1KV - XLPE",
                        ramal: "Ramal monof√°sico refor√ßado",
                        tipo: "CATEGORIA M3"
                    }
                },
                "T1": {
                    "TRIFASICO": {
                        disjuntor: "40A TRIPOLAR CURVA C",
                        cabo: "6mm¬≤ - 1KV - XLPE",
                        ramal: "3x6+6 CU XLPE",
                        tipo: "CATEGORIA T1"
                    }
                },
                "T2": {
                    "TRIFASICO": {
                        disjuntor: "50A TRIPOLAR CURVA C",
                        cabo: "10mm¬≤ - 1KV - XLPE",
                        ramal: "3x10+10 CU XLPE",
                        tipo: "CATEGORIA T2"
                    }
                },
                "T3": {
                    "TRIFASICO": {
                        disjuntor: "70A TRIPOLAR CURVA C",
                        cabo: "16mm¬≤ - 1KV - XLPE",
                        ramal: "3x16+16 CU XLPE",
                        tipo: "CATEGORIA T3"
                    }
                },
                "T4": {
                    "TRIFASICO": {
                        disjuntor: "100A TRIPOLAR CURVA C",
                        cabo: "35mm¬≤ - 1KV - XLPE",
                        ramal: "3x35+25 CU XLPE",
                        tipo: "CATEGORIA T4"
                    }
                },
                "T5": {
                    "TRIFASICO": {
                        disjuntor: "125A TRIPOLAR CURVA C",
                        cabo: "50mm¬≤ - 1KV - XLPE",
                        ramal: "3x50+25 CU XLPE",
                        tipo: "CATEGORIA T5"
                    }
                }
            },
            "EQUATORIAL": {
                "M1": {
                    "MONOFASICO": {
                        disjuntor: "25A MONOPOLAR CURVA C",
                        cabo: "Cabo de cobre conc√™ntrico 4mm¬≤",
                        ramal: "Cabo de cobre conc√™ntrico 4mm¬≤",
                        tipo: "CATEGORIA M1"
                    }
                },
                "M2": {
                    "MONOFASICO": {
                        disjuntor: "40A MONOPOLAR CURVA C",
                        cabo: "Cabo de cobre conc√™ntrico 6mm¬≤",
                        ramal: "Cabo de cobre conc√™ntrico 6mm¬≤",
                        tipo: "CATEGORIA M2"
                    }
                },
                "M3": {
                    "MONOFASICO": {
                        disjuntor: "63A MONOPOLAR CURVA C",
                        cabo: "Cabo de cobre conc√™ntrico 10mm¬≤",
                        ramal: "Cabo de cobre conc√™ntrico 10mm¬≤",
                        tipo: "CATEGORIA M3"
                    }
                },
                "T1": {
                    "TRIFASICO": {
                        disjuntor: "40A TRIPOLAR CURVA C",
                        cabo: "Cabo de cobre multiplexado 6mm¬≤",
                        ramal: "Cabo de cobre multiplexado 6mm¬≤",
                        tipo: "CATEGORIA T1"
                    }
                },
                "T2": {
                    "TRIFASICO": {
                        disjuntor: "63A TRIPOLAR CURVA C",
                        cabo: "Cabo de cobre multiplexado 10mm¬≤",
                        ramal: "Cabo de cobre multiplexado 10mm¬≤",
                        tipo: "CATEGORIA T2"
                    }
                },
                "T3": {
                    "TRIFASICO": {
                        disjuntor: "80A TRIPOLAR CURVA C",
                        cabo: "Cabo de cobre multiplexado 16mm¬≤",
                        ramal: "Cabo de cobre multiplexado 16mm¬≤",
                        tipo: "CATEGORIA T3"
                    }
                },
                "T4": {
                    "TRIFASICO": {
                        disjuntor: "100A TRIPOLAR CURVA C",
                        cabo: "Cabo de cobre multiplexado 25mm¬≤",
                        ramal: "Cabo de cobre multiplexado 25mm¬≤",
                        tipo: "CATEGORIA T4"
                    }
                },
                "T5": {
                    "TRIFASICO": {
                        disjuntor: "125A TRIPOLAR CURVA C",
                        cabo: "Cabo de cobre multiplexado 35mm¬≤",
                        ramal: "Cabo de cobre multiplexado 35mm¬≤",
                        tipo: "CATEGORIA T5"
                    }
                }
            },
            "NEOENERGIA": {
                "M2/M3": {
                    "MONOFASICO": {
                        disjuntor: "40A MONOPOLAR CURVA C",
                        cabo: "10mm¬≤ AL CONC",
                        ramal: "Ramal a√©reo padr√£o",
                        tipo: "CATEGORIA M2/M3"
                    }
                },
                "M3": {
                    "MONOFASICO": {
                        disjuntor: "63A MONOPOLAR CURVA C",
                        cabo: "16mm¬≤ AL CONC",
                        ramal: "Ramal a√©reo refor√ßado",
                        tipo: "CATEGORIA M3"
                    }
                },
                "T6": {
                    "TRIFASICO": {
                        disjuntor: "32A TRIPOLAR CURVA C",
                        cabo: "3x10+10 AL MULT",
                        ramal: "3x6+6 CU XLPE",
                        tipo: "CATEGORIA T6"
                    }
                },
                "T7": {
                    "TRIFASICO": {
                        disjuntor: "40A TRIPOLAR CURVA C",
                        cabo: "3x10+10 AL MULT",
                        ramal: "3x6+6 CU XLPE",
                        tipo: "CATEGORIA T7"
                    }
                }
            },
            "CEMIG": {
                "M2/M3": {
                    "MONOFASICO": {
                        disjuntor: "Consultar CEMIG",
                        cabo: "Consultar CEMIG",
                        ramal: "Consultar CEMIG",
                        tipo: "Consultar CEMIG"
                    }
                },
                "M3": {
                    "MONOFASICO": {
                        disjuntor: "Consultar CEMIG",
                        cabo: "Consultar CEMIG",
                        ramal: "Consultar CEMIG",
                        tipo: "Consultar CEMIG"
                    }
                },
                "T6": {
                    "TRIFASICO": {
                        disjuntor: "Consultar CEMIG",
                        cabo: "Consultar CEMIG",
                        ramal: "Consultar CEMIG",
                        tipo: "Consultar CEMIG"
                    }
                },
                "T7": {
                    "TRIFASICO": {
                        disjuntor: "Consultar CEMIG",
                        cabo: "Consultar CEMIG",
                        ramal: "Consultar CEMIG",
                        tipo: "Consultar CEMIG"
                    }
                }
            }
        };

        // Configura√ß√£o para Equatorial baseada na dist√¢ncia da orla
        const configEquatorialOrla = {
            "ATE_2KM": {
                "M1": { cabo: "Cabo de cobre conc√™ntrico 4mm¬≤", ramal: "Cabo de cobre conc√™ntrico 4mm¬≤" },
                "M2": { cabo: "Cabo de cobre conc√™ntrico 6mm¬≤", ramal: "Cabo de cobre conc√™ntrico 6mm¬≤" },
                "M3": { cabo: "Cabo de cobre conc√™ntrico 10mm¬≤", ramal: "Cabo de cobre conc√™ntrico 10mm¬≤" },
                "T1": { cabo: "Cabo de cobre multiplexado 6mm¬≤", ramal: "Cabo de cobre multiplexado 6mm¬≤" },
                "T2": { cabo: "Cabo de cobre multiplexado 10mm¬≤", ramal: "Cabo de cobre multiplexado 10mm¬≤" },
                "T3": { cabo: "Cabo de cobre multiplexado 16mm¬≤", ramal: "Cabo de cobre multiplexado 16mm¬≤" },
                "T4": { cabo: "Cabo de cobre multiplexado 25mm¬≤", ramal: "Cabo de cobre multiplexado 25mm¬≤" },
                "T5": { cabo: "Cabo de cobre multiplexado 35mm¬≤", ramal: "Cabo de cobre multiplexado 35mm¬≤" }
            },
            "ACIMA_2KM": {
                "M1": { cabo: "Cabo de Alum√≠nio multiplexado 10mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 10mm¬≤" },
                "M2": { cabo: "Cabo de Alum√≠nio multiplexado 10mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 10mm¬≤" },
                "M3": { cabo: "Cabo de Alum√≠nio multiplexado 10mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 10mm¬≤" },
                "T1": { cabo: "Cabo de Alum√≠nio multiplexado 10mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 10mm¬≤" },
                "T2": { cabo: "Cabo de Alum√≠nio multiplexado 16mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 16mm¬≤" },
                "T3": { cabo: "Cabo de Alum√≠nio multiplexado 25mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 25mm¬≤" },
                "T4": { cabo: "Cabo de Alum√≠nio multiplexado 35mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 35mm¬≤" },
                "T5": { cabo: "Cabo de Alum√≠nio multiplexado 50mm¬≤", ramal: "Cabo de Alum√≠nio multiplexado 50mm¬≤" }
            }
        };

        // Fun√ß√£o para calcular o disjuntor individual CORRIGIDA
        function calcularDisjuntor(corrente) {
            const faixas = [
                {max: 9, disjuntor: 10},
                {max: 14.6, disjuntor: 16},
                {max: 19.1, disjuntor: 20},
                {max: 24.1, disjuntor: 32},
                {max: 31.1, disjuntor: 32},
                {max: 39.0, disjuntor: 40},
                {max: 49.1, disjuntor: 50},
                {max: 62.1, disjuntor: 63},
                {max: 69.1, disjuntor: 70},
                {max: 79.1, disjuntor: 80},
                {max: 89.1, disjuntor: 100},
                {max: 99.1, disjuntor: 100},
                {max: 124.1, disjuntor: 125}
            ];
            
            for (let faixa of faixas) {
                if (corrente <= faixa.max) {
                    return faixa.disjuntor;
                }
            }
            return "Verificar";
        }

        // Fun√ß√£o para calcular os cabos do inversor individual CORRIGIDA
        function calcularCabosInversor(disjuntor, classe) {
            const cabosMonofasico = {
                10: "4mm¬≤", 16: "4mm¬≤", 20: "4mm¬≤", 25: "4mm¬≤",
                32: "6mm¬≤", 40: "6mm¬≤", 50: "10mm¬≤", 63: "16mm¬≤",
                70: "16mm¬≤", 80: "25mm¬≤", 90: "25mm¬≤", 100: "35mm¬≤", 125: "50mm¬≤"
            };
            
            const cabosTrifasico = {
                20: "4mm¬≤", 25: "4mm¬≤", 32: "6mm¬≤", 40: "10mm¬≤",
                50: "16mm¬≤", 63: "16mm¬≤", 70: "25mm¬≤", 80: "25mm¬≤",
                90: "35mm¬≤", 100: "50mm¬≤", 125: "70mm¬≤"
            };
            
            if (classe === "MONOF√ÅSICO") {
                return cabosMonofasico[disjuntor] || "Consultar tabela";
            } else {
                return cabosTrifasico[disjuntor] || "Consultar tabela";
            }
        }

        // Fun√ß√£o para extrair valor num√©rico do disjuntor
        function extrairValorDisjuntor(disjuntorStr) {
            const match = disjuntorStr.match(/(\d+)A/);
            return match ? parseInt(match[1]) : 0;
        }

        // Fun√ß√£o para determinar a classe baseada na pot√™ncia
        function determinarClasse(concessionaria, configTensao, potenciaTotal) {
            const faixas = classesDemanda[concessionaria][configTensao];
            if (!faixas) return null;

            for (const faixa of faixas) {
                if (potenciaTotal >= faixa.min && potenciaTotal <= faixa.max) {
                    return faixa.classe;
                }
            }
            return null;
        }

        // Fun√ß√£o para ajustar a classe baseada na corrente
        function ajustarClassePorCorrente(concessionaria, configTensao, classeInicial, correnteTotal) {
            const faixas = classesDemanda[concessionaria][configTensao];
            if (!faixas) return classeInicial;

            // Encontrar a classe atual
            let indiceAtual = -1;
            for (let i = 0; i < faixas.length; i++) {
                if (faixas[i].classe === classeInicial) {
                    indiceAtual = i;
                    break;
                }
            }

            if (indiceAtual === -1) return classeInicial;

            // Verificar se a corrente excede o disjuntor da classe atual
            const classeAtual = dimensionamento[concessionaria][classeInicial][configTensao];
            const correnteDisjuntorAtual = extrairValorDisjuntor(classeAtual.disjuntor);

            if (correnteTotal <= correnteDisjuntorAtual) {
                return classeInicial; // N√£o precisa ajustar
            }

            // Procurar uma classe com disjuntor maior
            for (let i = indiceAtual + 1; i < faixas.length; i++) {
                const classeCandidata = faixas[i].classe;
                const configClasse = dimensionamento[concessionaria][classeCandidata][configTensao];
                const correnteDisjuntorCandidato = extrairValorDisjuntor(configClasse.disjuntor);

                if (correnteTotal <= correnteDisjuntorCandidato) {
                    return classeCandidata;
                }
            }

            // Se chegou aqui, n√£o h√° classe com disjuntor suficiente
            return null;
        }

        // Fun√ß√£o para calcular PD da classe
        function obterPDClasse(concessionaria, configTensao, classe) {
            const faixas = classesDemanda[concessionaria][configTensao];
            if (!faixas) return 0;

            for (const faixa of faixas) {
                if (faixa.classe === classe) {
                    return faixa.pd;
                }
            }
            return 0;
        }

        // Fun√ß√£o para calcular carga m√≠nima necess√°ria CORRIGIDA
        function calcularCargaMinima(potenciaTotal, faixa) {
            // A carga m√≠nima deve ser a MAIOR entre a carga m√≠nima da faixa e a pot√™ncia dos inversores
            return Math.max(faixa.min, potenciaTotal);
        }

        // Vari√°veis globais
        let selectedInversors = [];

        // Elementos DOM
        const concessionariaSelect = document.getElementById('concessionariaSelect');
        const inversorSelect = document.getElementById('inversorSelect');
        const addInversorBtn = document.getElementById('addInversorBtn');
        const selectedInversorsDiv = document.getElementById('selectedInversors');
        const configTensaoGroup = document.getElementById('configTensaoGroup');
        const configTensao = document.getElementById('configTensao');
        const warningTrifasico = document.getElementById('warningTrifasico');
        const configOrlaGroup = document.getElementById('configOrlaGroup');
        const configOrla = document.getElementById('configOrla');
        const resultsDiv = document.getElementById('results');
        const demandaInfoDiv = document.getElementById('demandaInfo');
        const concessionariaInfoDiv = document.getElementById('concessionariaInfo');
        const protecaoInversoresDiv = document.getElementById('protecaoInversores');
        const cargaNecessariaInfo = document.getElementById('cargaNecessariaInfo');
        const autoAdjustMessage = document.getElementById('autoAdjustMessage');

        // Event Listeners
        concessionariaSelect.addEventListener('change', function() {
            const concessionaria = this.value;
            updateInversorOptions();
            configTensaoGroup.style.display = concessionaria ? 'block' : 'none';
            configOrlaGroup.style.display = concessionaria === 'EQUATORIAL' ? 'block' : 'none';
            clearResults();
        });

        configTensao.addEventListener('change', function() {
            updateInversorOptions();
            clearResults();
        });

        configOrla.addEventListener('change', function() {
            if (selectedInversors.length > 0) {
                calculateDimensionamento();
            }
        });

        addInversorBtn.addEventListener('click', function() {
            const selectedInversorValue = inversorSelect.value;
            if (selectedInversorValue) {
                const inversor = JSON.parse(selectedInversorValue);
                
                // Verificar compatibilidade para rede monof√°sica
                if (configTensao.value === 'MONOFASICO' && inversor.classe === 'TRIF√ÅSICO') {
                    alert('Inversor trif√°sico n√£o pode ser conectado em rede monof√°sica');
                    return;
                }
                
                addInversor(inversor);
                inversorSelect.value = '';
                calculateDimensionamento();
            }
        });

        // Fun√ß√£o para atualizar op√ß√µes de inversores CORRIGIDA
        function updateInversorOptions() {
            const config = configTensao.value;
            const concessionaria = concessionariaSelect.value;
            
            inversorSelect.innerHTML = '<option value="">-- Selecione --</option>';

            if (!concessionaria || !config) return;

            let filteredInversors = [];
            
            if (config === 'MONOFASICO') {
                // Em rede monof√°sica: s√≥ mostra inversores monof√°sicos
                filteredInversors = bancoDeDados.filter(inv => inv.classe === "MONOF√ÅSICO");
            } else {
                // Em rede trif√°sica: mostra tanto trif√°sicos quanto monof√°sicos
                filteredInversors = bancoDeDados.filter(inv => 
                    inv.classe === "TRIF√ÅSICO" || inv.classe === "MONOF√ÅSICO"
                );
            }

            filteredInversors.forEach(inv => {
                const option = document.createElement('option');
                option.value = JSON.stringify(inv);
                option.textContent = `${inv.inversor} (${inv.potencia}kW - ${inv.corrente}A - ${inv.classe})`;
                inversorSelect.appendChild(option);
            });
        }

        // Fun√ß√£o para adicionar inversor √† lista (AGORA PERMITE M√öLTIPLOS)
        function addInversor(inversor) {
            // Criar ID √∫nico para cada inversor (permite m√∫ltiplos do mesmo tipo)
            const inversorComId = {
                ...inversor,
                id: Date.now() + Math.random() // ID √∫nico
            };
            selectedInversors.push(inversorComId);
            renderSelectedInversors();
        }

        // Fun√ß√£o para renderizar inversores selecionados
        function renderSelectedInversors() {
            selectedInversorsDiv.innerHTML = '';
            selectedInversors.forEach((inversor, index) => {
                const div = document.createElement('div');
                div.className = 'selected-inversor';
                div.innerHTML = `
                    <span>${inversor.inversor} (${inversor.potencia}kW - ${inversor.corrente}A)</span>
                    <button onclick="removeInversor(${index})">Remover</button>
                `;
                selectedInversorsDiv.appendChild(div);
            });
        }

        // Fun√ß√£o para remover inversor
        window.removeInversor = function(index) {
            selectedInversors.splice(index, 1);
            renderSelectedInversors();
            calculateDimensionamento();
        }

        // Fun√ß√£o para calcular o dimensionamento
        function calculateDimensionamento() {
            const concessionaria = concessionariaSelect.value;
            const config = configTensao.value;
            const configOrlaValue = configOrla.value;

            if (!concessionaria || !config || selectedInversors.length === 0) {
                clearResults();
                return;
            }

            // Calcular totais
            const quantidade = selectedInversors.length;
            const correnteTotal = selectedInversors.reduce((sum, inv) => sum + inv.corrente, 0);
            const potenciaTotal = selectedInversors.reduce((sum, inv) => sum + inv.potencia, 0);

            // Determinar classe inicial baseada na pot√™ncia
            let classe = determinarClasse(concessionaria, config, potenciaTotal);
            let classeOriginal = classe;
            let ajusteRealizado = false;

            // Ajustar classe baseada na corrente, se necess√°rio
            if (classe) {
                const classeAjustada = ajustarClassePorCorrente(concessionaria, config, classe, correnteTotal);
                if (classeAjustada && classeAjustada !== classe) {
                    classe = classeAjustada;
                    ajusteRealizado = true;
                }
            }

            // Obter configura√ß√£o da classe
            let configClasse = null;
            if (classe && dimensionamento[concessionaria] && dimensionamento[concessionaria][classe]) {
                configClasse = {...dimensionamento[concessionaria][classe][config]};
                
                // Ajustar para Equatorial baseado na orla
                if (concessionaria === 'EQUATORIAL') {
                    const configOrlaData = configEquatorialOrla[configOrlaValue];
                    if (configOrlaData && configOrlaData[classe]) {
                        configClasse.cabo = configOrlaData[classe].cabo;
                        configClasse.ramal = configOrlaData[classe].ramal;
                    }
                }
            }

            // Exibir resultados
            document.getElementById('quantidade').textContent = quantidade;
            document.getElementById('corrente').textContent = `${correnteTotal.toFixed(2)}A`;
            document.getElementById('potenciaTotal').textContent = `${potenciaTotal.toFixed(2)}kW`;

            if (configClasse) {
                document.getElementById('disjuntor').textContent = configClasse.disjuntor;
                document.getElementById('cabos').textContent = configClasse.ramal;
                
                // Exibir informa√ß√µes da concession√°ria
                document.getElementById('infoConcessionariaNome').textContent = concessionariaSelect.options[concessionariaSelect.selectedIndex].text;
                document.getElementById('infoDisjuntor').textContent = configClasse.disjuntor;
                document.getElementById('infoCabo').textContent = configClasse.cabo;
                document.getElementById('infoRamal').textContent = configClasse.ramal;
                document.getElementById('infoTipo').textContent = configClasse.tipo;
                
                concessionariaInfoDiv.className = `concessionaria-info ${concessionaria.toLowerCase()}`;
                concessionariaInfoDiv.style.display = 'block';
            } else {
                document.getElementById('disjuntor').textContent = 'N√£o dispon√≠vel';
                document.getElementById('cabos').textContent = 'N√£o dispon√≠vel';
                concessionariaInfoDiv.style.display = 'none';
            }

            // Exibir informa√ß√µes de demanda
            if (classe) {
                const faixas = classesDemanda[concessionaria][config];
                const faixa = faixas.find(f => f.classe === classe);
                const pdClasse = obterPDClasse(concessionaria, config, classe);
                const cargaMinima = calcularCargaMinima(potenciaTotal, faixa);
                
                document.getElementById('faixaDemanda').textContent = `${faixa.min}kW - ${faixa.max}kW`;
                document.getElementById('classeSistema').textContent = classe;
                document.getElementById('potenciaDisponibilizada').textContent = `${pdClasse}kW`;
                
                // Verificar se a pot√™ncia est√° dentro da PD
                const dentroDaPD = potenciaTotal <= pdClasse;
                document.getElementById('statusPotencia').innerHTML = dentroDaPD ? 
                    '<span style="color: green;">‚úÖ Dentro do limite da PD</span>' : 
                    '<span style="color: red;">‚ùå Excede a PD</span>';
                
                document.getElementById('cargaMinima').innerHTML = `
                    ${cargaMinima}kW
                    ${cargaMinima > faixa.min ? `<br><small style="color: #e67e22;">(Ajustada para atender a pot√™ncia dos inversores)</small>` : ''}
                `;
                
                // Informa√ß√£o sobre carga necess√°ria CORRIGIDA
                cargaNecessariaInfo.style.display = 'block';
                if (potenciaTotal > pdClasse) {
                    cargaNecessariaInfo.className = 'error';
                    document.getElementById('cargaNecessariaText').innerHTML = 
                        `A pot√™ncia total (<strong>${potenciaTotal.toFixed(2)}kW</strong>) excede a PD da classe <strong>${classe}</strong> 
                        (<strong>${pdClasse}kW</strong>). Considere reduzir a pot√™ncia ou alterar a classe.`;
                } else if (cargaMinima > faixa.min) {
                    cargaNecessariaInfo.className = 'warning';
                    document.getElementById('cargaNecessariaText').innerHTML = 
                        `Para a classe <strong>${classe}</strong> a carga instalada deve ser de <strong>${cargaMinima}kW a ${faixa.max}kW</strong>. 
                        <br><small>üí° <strong>Importante:</strong> A carga instalada (${cargaMinima}kW) deve ser ‚â• √† pot√™ncia dos inversores (${potenciaTotal.toFixed(2)}kW)</small>`;
                } else {
                    cargaNecessariaInfo.className = 'success';
                    document.getElementById('cargaNecessariaText').innerHTML = 
                        `Sistema adequado para a classe <strong>${classe}</strong>. 
                        Pot√™ncia: <strong>${potenciaTotal.toFixed(2)}kW</strong> | PD: <strong>${pdClasse}kW</strong> | 
                        Carga m√≠nima: <strong>${cargaMinima}kW</strong>`;
                }
                
                demandaInfoDiv.style.display = 'block';
            } else {
                demandaInfoDiv.style.display = 'none';
                cargaNecessariaInfo.style.display = 'none';
            }

            // Exibir mensagem de ajuste autom√°tico, se aplic√°vel
            if (ajusteRealizado) {
                autoAdjustMessage.style.display = 'block';
                document.getElementById('adjustmentDetails').innerHTML = 
                    `A classe foi ajustada de <strong>${classeOriginal}</strong> para <strong>${classe}</strong> 
                    devido √† corrente total de <strong>${correnteTotal.toFixed(2)}A</strong>.`;
            } else {
                autoAdjustMessage.style.display = 'none';
            }

            resultsDiv.style.display = 'block';

            // Exibir informa√ß√µes de prote√ß√£o individual dos inversores
            renderProtecaoIndividual();
        }

        // Fun√ß√£o para renderizar prote√ß√£o individual CORRIGIDA
        function renderProtecaoIndividual() {
            const container = document.getElementById('detalhesProtecaoInversores');
            container.innerHTML = '';

            selectedInversors.forEach((inversor, index) => {
                const div = document.createElement('div');
                div.className = 'protecao-individual';
                
                // Calcular disjuntor individual CORRETO
                const disjuntorIndividual = calcularDisjuntor(inversor.corrente);
                const cabosIndividual = calcularCabosInversor(disjuntorIndividual, inversor.classe);
                
                div.innerHTML = `
                    <h5>Inversor ${index + 1}: ${inversor.inversor}</h5>
                    <div class="inversor-detail-item">
                        <span class="detail-label">Pot√™ncia:</span>
                        <span class="detail-value">${inversor.potencia}kW</span>
                    </div>
                    <div class="inversor-detail-item">
                        <span class="detail-label">Corrente M√°xima:</span>
                        <span class="detail-value">${inversor.corrente}A</span>
                    </div>
                    <div class="inversor-detail-item">
                        <span class="detail-label">Disjuntor Individual:</span>
                        <span class="detail-value">${disjuntorIndividual}A (Curva C)</span>
                    </div>
                    <div class="inversor-detail-item">
                        <span class="detail-label">Cabo Individual:</span>
                        <span class="detail-value">${cabosIndividual}</span>
                    </div>
                `;
                container.appendChild(div);
            });

            protecaoInversoresDiv.style.display = 'block';
        }

        // Fun√ß√£o para limpar resultados
        function clearResults() {
            resultsDiv.style.display = 'none';
            demandaInfoDiv.style.display = 'none';
            concessionariaInfoDiv.style.display = 'none';
            protecaoInversoresDiv.style.display = 'none';
            cargaNecessariaInfo.style.display = 'none';
            autoAdjustMessage.style.display = 'none';
        }

        // Inicializa√ß√£o
        updateInversorOptions();
    </script>
</body>
</html>
